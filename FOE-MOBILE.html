<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FOE Game</title>
<style>
    body {
        font-family: 'Arial', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
    }
    .game-container {
        max-width: 90vw;
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    .grid {
        display: grid;
        gap: 5px;
        margin-bottom: 20px;
        overflow: hidden; /* Ensure grid does not overflow on small screens */
    }
    .cell {
        aspect-ratio: 1/1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        cursor: pointer;
        background-color: #e0e0e0;
        transition: background-color 0.3s;
    }
    .cell.revealed-player1 {
        background-color: #3498db;
        color: white;
    }
    .cell.revealed-cpu1 {
        background-color: #e67e22;
        color: white;
    }
    .cell.temp-revealed {
        background-color: #f1c40f;
    }
    .cell.valid-move {
        border: 2px solid #2ecc71;
    }
    .player-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    .player-box {
        padding: 10px;
        border-radius: 5px;
        width: 48%;
        background-color: #f9f9f9;
    }
    .player-box.active {
        background-color: #e8f8e8;
    }
    .combo-bars {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    .combo-bar {
        height: 20px;
        background-color: #ecf0f1;
        border-radius: 10px;
        overflow: hidden;
    }
    .combo-bar-fill {
        height: 100%;
        width: 0%;
        transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
    }
    .combo-bar-fill.five {
        background-color: #e74c3c;
    }
    .combo-bar-fill.odd {
        background-color: #3498db;
    }
    .combo-bar-fill.even {
        background-color: #2ecc71;
    }
    .combo-bar-fill.maxed {
        background-color: gold !important;
    }
    @keyframes flash {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }
    .combo-bar-fill.flashing {
        animation: flash 0.5s linear infinite;
    }
    button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        background-color: #2ecc71;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    button:hover {
        background-color: #27ae60;
    }
    select {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
    }
    .game-over-dialog {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        text-align: center;
        z-index: 1000;
    }
</style>
</head>
<body>
<div class="game-container">
<h1>FOE Game</h1>
<div id="game-start">
<label for="grid-size">Select Grid Size:</label>
<select id="grid-size">
<option value="5">5x5</option>
<option value="10" selected>10x10</option>
</select>
<button id="start-game">Start Game</button>
</div>
<div id="game-play" style="display:none;">
<div class="player-info">
<div id="player1-info" class="player-box">
<h2>PLAYER1</h2>
<p>Score: <span id="player1-score">0</span></p>
<p>Multiplier: <span id="player1-multiplier">1</span>x</p>
<div class="combo-bars">
<div class="combo-bar"><div id="player1-five" class="combo-bar-fill five"></div></div>
<div class="combo-bar"><div id="player1-odd" class="combo-bar-fill odd"></div></div>
<div class="combo-bar"><div id="player1-even" class="combo-bar-fill even"></div></div>
</div>
</div>
<div id="cpu1-info" class="player-box">
<h2>CPU1</h2>
<p>Score: <span id="cpu1-score">0</span></p>
<p>Multiplier: <span id="cpu1-multiplier">1</span>x</p>
<div class="combo-bars">
<div class="combo-bar"><div id="cpu1-five" class="combo-bar-fill five"></div></div>
<div class="combo-bar"><div id="cpu1-odd" class="combo-bar-fill odd"></div></div>
<div class="combo-bar"><div id="cpu1-even" class="combo-bar-fill even"></div></div>
</div>
</div>
</div>
<div id="grid" class="grid"></div>
<div id="current-player"></div>
<button id="reset-game">Reset Game</button>
</div>
</div>
<div id="game-over-dialog" class="game-over-dialog">
<h2>Game Over!</h2>
<p id="winner-text"></p>
<p>Final Scores:</p>
<p>PLAYER1: <span id="final-score-player1"></span></p>
<p>CPU1: <span id="final-score-cpu1"></span></p>
<button id="restart-game">Play Again</button>
</div>
<script>
const REVEAL_TIME = 2000;
const MAX_COMBO = 10;

let gameState = 'START';
let gridSize = 10;
let grid = [];
let currentPlayer = 'PLAYER1';
let playerCells = {
    PLAYER1: [],
    CPU1: []
};
let scores = {
    PLAYER1: 0,
    CPU1: 0
};
let combos = {
    PLAYER1: [],
    CPU1: []
};
let scoreMultipliers = {
    PLAYER1: 1,
    CPU1: 1
};
let fiveMultipliers = {
    PLAYER1: 1,
    CPU1: 1
};
let isRevealing = false;

function initializeGame() {
    const numCells = gridSize * gridSize;
    grid = Array.from({ length: numCells }, (cell, index) => ({
        value: index + 1,
        revealed: false,
        owner: null,
        tempRevealed: false
    }));

    // Shuffle grid
    for (let i = grid.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [grid[i], grid[j]] = [grid[j], grid[i]];
    }

    currentPlayer = 'PLAYER1';
    playerCells = {
        PLAYER1: [],
        CPU1: []
    };
    scores = {
        PLAYER1: 0,
        CPU1: 0
    };
    combos = {
        PLAYER1: [],
        CPU1: []
    };
    scoreMultipliers = {
        PLAYER1: 1,
        CPU1: 1
    };
    fiveMultipliers = {
        PLAYER1: 1,
        CPU1: 1
    };
    gameState = 'PLAYING';

    renderGame();
}

function renderGame() {
    const gridElement = document.getElementById('grid');
    gridElement.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
    gridElement.innerHTML = '';

    grid.forEach((cell, index) => {
        const cellElement = document.createElement('div');
        cellElement.className = 'cell';

        if (cell.revealed) {
            cellElement.classList.add(`revealed-${cell.owner.toLowerCase()}`);
            cellElement.textContent = cell.value;
        } else if (cell.tempRevealed) {
            cellElement.classList.add('temp-revealed');
            cellElement.textContent = cell.value;
        } else if (isValidMove(index) && currentPlayer === 'PLAYER1' && gameState === 'PLAYING') {
            cellElement.classList.add('valid-move');
        }

        cellElement.addEventListener('click', () => {
            if (!isRevealing && isValidMove(index) && gameState === 'PLAYING') {
                revealCell(index);
            }
        });

        gridElement.appendChild(cellElement);
    });

    updatePlayerInfo();
    updateCurrentPlayer();
    checkGameOver();
}

function updatePlayerInfo() {
    document.getElementById('player1-score').textContent = scores.PLAYER1;
    document.getElementById('player1-multiplier').textContent = scoreMultipliers.PLAYER1;
    updateComboBars('player1');

    document.getElementById('cpu1-score').textContent = scores.CPU1;
    document.getElementById('cpu1-multiplier').textContent = scoreMultipliers.CPU1;
    updateComboBars('cpu1');
}

function updateComboBars(player) {
    const comboTypes = ['five', 'odd', 'even'];

    comboTypes.forEach(type => {
        const comboBar = document.getElementById(`${player}-${type}`);
        const currentCombo = combos[player].filter(combo => combo.type === type).length;
        const maxedCombo = currentCombo >= MAX_COMBO;
        comboBar.style.width = `${(currentCombo / MAX_COMBO) * 100}%`;
        comboBar.classList.toggle('maxed', maxedCombo);
        comboBar.classList.toggle('flashing', maxedCombo && gameState === 'PLAYING');
    });
}

function updateCurrentPlayer() {
    document.getElementById('current-player').textContent = `Current Player: ${currentPlayer}`;
}

function checkGameOver() {
    const allRevealed = grid.every(cell => cell.revealed);
    if (allRevealed) {
        gameState = 'GAME_OVER';
        showGameOverDialog();
    }
}

function showGameOverDialog() {
    const gameOverDialog = document.getElementById('game-over-dialog');
    gameOverDialog.style.display = 'block';

    const winnerText = document.getElementById('winner-text');
    if (scores.PLAYER1 > scores.CPU1) {
        winnerText.textContent = 'PLAYER1 wins!';
    } else if (scores.CPU1 > scores.PLAYER1) {
        winnerText.textContent = 'CPU1 wins!';
    } else {
        winnerText.textContent = 'It\'s a tie!';
    }

    document.getElementById('final-score-player1').textContent = scores.PLAYER1;
    document.getElementById('final-score-cpu1').textContent = scores.CPU1;

    const restartButton = document.getElementById('restart-game');
    restartButton.addEventListener('click', () => {
        gameOverDialog.style.display = 'none';
        initializeGame();
    });
}

function isValidMove(index) {
    return !grid[index].revealed && !grid[index].tempRevealed;
}

function revealCell(index) {
    const cell = grid[index];
    cell.tempRevealed = true;
    renderGame();

    setTimeout(() => {
        cell.tempRevealed = false;
        cell.revealed = true;
        cell.owner = currentPlayer;
        playerCells[currentPlayer].push(cell.value);
        calculateScore(currentPlayer, cell.value);
        calculateCombos(currentPlayer);
        renderGame();
        switchPlayer();
    }, REVEAL_TIME);
}

function calculateScore(player, value) {
    scores[player] += value * scoreMultipliers[player];
}

function calculateCombos(player) {
    const playerCellsSum = playerCells[player].reduce((acc, curr) => acc + curr, 0);

    if (playerCellsSum % 5 === 0) {
        scoreMultipliers[player] += fiveMultipliers[player];
        combos[player].push({ type: 'five' });
    }

    if (playerCellsSum % 2 !== 0) {
        scoreMultipliers[player]++;
        combos[player].push({ type: 'odd' });
    }

    if (playerCellsSum % 2 === 0) {
        scoreMultipliers[player]++;
        combos[player].push({ type: 'even' });
    }
}

function switchPlayer() {
    currentPlayer = currentPlayer === 'PLAYER1' ? 'CPU1' : 'PLAYER1';

    if (currentPlayer === 'CPU1' && gameState === 'PLAYING') {
        cpuMove();
    }

    updateCurrentPlayer();
}

function cpuMove() {
    const validMoves = grid.filter((cell, index) => isValidMove(index));
    if (validMoves.length > 0) {
        const randomIndex = Math.floor(Math.random() * validMoves.length);
        const chosenCell = validMoves[randomIndex];
        revealCell(grid.indexOf(chosenCell));
    }
}

document.getElementById('start-game').addEventListener('click', () => {
    gridSize = parseInt(document.getElementById('grid-size').value, 10);
    initializeGame();
    document.getElementById('game-start').style.display = 'none';
    document.getElementById('game-play').style.display = 'block';
});

document.getElementById('reset-game').addEventListener('click', () => {
    document.getElementById('game-start').style.display = 'block';
    document.getElementById('game-play').style.display = 'none';
    document.getElementById('game-over-dialog').style.display = 'none';
    gameState = 'START';
});

initializeGame();
</script>
</body>
</html>
